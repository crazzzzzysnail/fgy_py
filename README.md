# 自动化任务脚本

这是一个Python自动化任务脚本，它可以根据HAR文件记录的HTTP请求，自动、并发地执行这些请求。脚本采用模块化设计，易于扩展和维护。

## 核心功能

- **模块化设计**: 代码结构清晰，核心功能（如HAR解析、请求发送、日志记录）被拆分到独立的模块中。
- **多线程执行**: 所有在配置文件中定义的任务都会并行处理，显著提升执行效率。
- **配置驱动**: 无需修改任何Python代码，只需编辑 `tasks.json` 文件即可轻松添加、删除或修改任务。
- **HAR文件支持**: 直接使用网络抓包工具（如 Fiddler, Charles, ProxyPin）导出的 `.har` 文件作为请求模板。
- **完整日志**: 所有操作都会被记录到 `task.log` 文件中，方便调试和追踪任务执行情况。

## 项目结构

```
.
├── har/
│   ├── reward.har
│   ├── task1.har
│   ├── task3.har
│   ├── task5.har
│   └── task10.har
├── main.py             # 主程序入口
├── tasks.json          # 任务配置文件
├── har_parser.py       # HAR文件解析器模块
├── request_sender.py   # HTTP请求发送器模块
├── logger_setup.py     # 日志配置模块
└── README.md           # 项目说明文件
```
*注意: `task.log` 文件会在脚本首次运行时自动生成。*

## 安装指南

1.  **环境要求**:
    - Python 3.6 或更高版本。

2.  **安装依赖**:
    本项目仅依赖 `requests` 库。请通过以下命令安装：
    ```bash
    pip install requests
    ```
    如果您在使用青龙面板，请在“依赖管理”中添加 `requests`。

## 使用方法

### 1. 本地运行

直接在项目根目录下执行主程序：
```bash
python main.py
```

### 2. 在青龙面板中部署

1.  将本项目的所有文件（包括 `har` 文件夹）上传到青龙面板的脚本目录（例如 `/ql/scripts/`）。
2.  登录青龙面板，进入“依赖管理”，在“Python”标签页下，确保已添加 `requests` 依赖。
3.  进入“定时任务”，点击“新建任务”，并按以下内容填写：
    - **名称**: 自定义，例如“自动化HAR任务”
    - **命令**: `python /ql/scripts/你的项目文件夹名/main.py`
    - **定时规则**: 根据您的需求设置，例如 `0 8 * * *` 表示每天早上8点执行。
4.  保存并手动运行一次以测试是否配置正确。

## 配置说明

所有的任务都在 `tasks.json` 文件中进行管理。该文件是一个JSON数组，每个对象代表一个独立的任务。

**字段说明:**

- `name` (字符串): 任务的名称，会显示在日志中。
- `har_file` (字符串): HAR文件的路径（相对于项目根目录）。
- `count` (整数): 当前任务需要重复执行的次数。
- `interval_seconds` (整数): 对于需要多次执行的任务，每次请求之间的等待时间（单位：秒）。

## 日志系统

- 脚本运行时，所有日志信息会同时输出到控制台和项目根目录下的 `task.log` 文件。
- 日志文件会记录每个任务的开始、结束、请求发送状态以及最终的完成信息，方便您随时检查任务的执行情况。